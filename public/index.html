<!DOCTYPE html>
<html>
  <head>
    <title>DeskReg POC</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
      body {
        font-family: sans-serif;
        padding: 2rem;
      }
      section {
        margin-bottom: 2rem;
      }
      h2 {
        border-bottom: 1px solid #ccc;
        padding-bottom: 0.3rem;
      }
      ul {
        padding-left: 1rem;
      }
      table {
        text-align: left;
        border-spacing: 0;
        border-collapse: collapse;
      }
      td,
      th {
        border: 1px solid black;
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ“‹ Desk Registration POC</h1>

    <section>
      <h2>ğŸ“¦ Check-in List</h2>
      <table id="checkins">
        <thead>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Room</th>
            <th>Device</th>
            <th>Action Time</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- <section>
      <h2>ğŸ‘¤ Users</h2>
      <ul id="users"></ul>
    </section>

    <section>
      <h2>ğŸ¢ Rooms</h2>
      <ul id="rooms"></ul>
    </section>

    <section>
      <h2>ğŸ’» Devices</h2>
      <ul id="devices"></ul>
    </section> -->

    <script>
      const socket = io();

      const form = document.getElementById("form");
      const nameInput = document.getElementById("name");
      const roomSelect = document.getElementById("room");
      const deviceSelect = document.getElementById("device");
      const checkinTable = document.getElementById("checkins");

      //   fetch("/rooms")
      //     .then((res) => res.json())
      //     .then((rooms) => {
      //       console.log(rooms);
      //       const list = document.getElementById("rooms");
      //       rooms.forEach((room) => {
      //         const li = document.createElement("li");
      //         li.innerText = `${room.id}: ${room.name}`;
      //         list.appendChild(li);
      //       });
      //     });

      //   // Fetch and fill devices
      //   fetch("/devices")
      //     .then((res) => res.json())
      //     .then((devices) => {
      //       const list = document.getElementById("devices");
      //       devices.forEach((device) => {
      //         const li = document.createElement("li");
      //         li.innerText = `${device.id}: ${device.name} (${device.uuid})`;
      //         list.appendChild(li);
      //       });
      //     });

      //   // Fetch and render users
      //   fetch("/users")
      //     .then((res) => res.json())
      //     .then((users) => {
      //       const list = document.getElementById("users");
      //       users.forEach((user) => {
      //         const li = document.createElement("li");
      //         li.innerText = `${user.id}: ${user.username}`;
      //         list.appendChild(li);
      //       });
      //     });

      // Fetch checkins
      fetch("/checkins")
        .then((res) => res.json())
        .then((data) => {
          data.forEach(appendCheckin);
        });

      // Realtime update
      socket.on("checkin:new", (data) => {
        appendCheckin(data);
      });

      function appendCheckin(data) {
        const tbody = checkinTable.querySelector("tbody");
        const tr = document.createElement("tr");

        tr.innerHTML = `
            <td>${data.name}</td>
            <td>${data.type ?? "-"}</td>
            <td>${data.room_id}</td>
            <td>${data.device_uuid}</td>
            <td>${new Date(data.created_at).toLocaleString()}</td>
        `;

        // tbody.append(tr);
        tbody.insertBefore(tr, tbody.firstChild);
      }
    </script>
  </body>
</html>
